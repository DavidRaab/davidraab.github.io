<!doctype html>
<html lang="en-us">
    <head>
        <title>Meta-Programming in Perl // David Raab</title>
        <link rel="shortcut icon" href="/favicon.ico" />
        <meta charset="utf-8" />
        <meta name="generator" content="Hugo 0.109.0">
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta name="author" content="David Raab" />
        <meta name="description" content="Introduction to Meta-programming in Perl. Understanding Type Globs in Perl." />
        <link rel="stylesheet" href="/css/main.min.0fa334c3f2650e7000dfc8e81f59d23191e59e78f62c565a598f4dc557c92abe.css" />
        <script src="/static/code-toggle.js"></script>

        
        <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Meta-Programming in Perl"/>
<meta name="twitter:description" content="Introduction to Meta-programming in Perl. Understanding Type Globs in Perl."/>

        <meta property="og:title" content="Meta-Programming in Perl" />
<meta property="og:description" content="Introduction to Meta-programming in Perl. Understanding Type Globs in Perl." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://davidraab.github.io/posts/meta-programming-in-perl/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-10-26T00:00:00+00:00" />
<meta property="article:modified_time" content="2023-10-26T00:00:00+00:00" />


    </head>
    <body>
        <header class="app-header">
            <a href="https://davidraab.github.io"><img class="app-header-avatar" src="/avatar.jpg" alt="David Raab" /></a>
            <span class="app-header-title">David Raab</span>
            <nav class="app-header-menu">
                    <a class="app-header-menu-item" href="/">Home</a>
                         - 
                    
                    <a class="app-header-menu-item" href="/tags/">Tags</a>
            </nav>
            <p>My personal Blog. Writing about programming and other stuff.</p>
            <div class="app-header-social">
                
                    <a href="https://github.com/DavidRaab" target="_blank" rel="noreferrer noopener me">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github">
  <title>David Raab Github Profile</title>
  <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
</svg>
                    </a>
                
                    <a href="https://davidraab.github.io/index.xml" target="_blank" rel="noreferrer noopener me">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-rss">
  <title>Atom Feed</title>
  <path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle>
</svg>
                    </a>
                
            </div>
        </header>
        
<main class="app-container">
    <article class="post">
        <header class="post-header">
            <h1 class ="post-title">Meta-Programming in Perl</h1>
            <div class="post-meta">
                <div>
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar">
  <title>calendar</title>
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line>
</svg>
                    Oct 26, 2023
                </div>
                <div>
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock">
  <title>clock</title>
  <circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline>
</svg>
                    8 min read
                </div>
                <div>
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag">
  <title>tag</title>
  <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line>
</svg>
                            <a class="tag" href="https://davidraab.github.io/tags/perl/">perl</a>
                            <a class="tag" href="https://davidraab.github.io/tags/metaprogramming/">metaprogramming</a>
                            <a class="tag" href="https://davidraab.github.io/tags/design-pattern/">design-pattern</a>
                </div>
            </div>
        </header>
        <div class="post-content">
            <p>In my last article about <a href="https://davidraab.github.io/posts/special-values-in-perl/">Special Values in Perl</a>
I explained how we can create true distinct values that can be safely distinguished
by other values. The final result looked like this:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-perl" data-lang="perl"><span class="line"><span class="cl"><span class="k">use</span> <span class="nn">Scalar::Util</span> <span class="sx">qw(refaddr reftype)</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Special values Red, Green and Blue</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span> <span class="c1"># &lt;-- this creates a new lexical-scope</span>
</span></span><span class="line"><span class="cl">    <span class="k">my</span> <span class="p">(</span><span class="nv">$red</span><span class="p">,</span> <span class="nv">$green</span><span class="p">,</span> <span class="nv">$blue</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">[]</span><span class="p">,</span> <span class="o">[]</span><span class="p">,</span> <span class="o">[]</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">sub</span> <span class="nf">red</span>   <span class="p">{</span> <span class="nv">$red</span>   <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">sub</span> <span class="nf">green</span> <span class="p">{</span> <span class="nv">$green</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">sub</span> <span class="nf">blue</span>  <span class="p">{</span> <span class="nv">$blue</span>  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">my</span> <span class="nv">$is_color</span> <span class="o">=</span> <span class="k">sub</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">my</span> <span class="p">(</span><span class="nv">$source</span><span class="p">,</span> <span class="nv">$color</span><span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">my</span> <span class="nv">$type</span> <span class="o">=</span> <span class="n">reftype</span><span class="p">(</span><span class="nv">$source</span><span class="p">)</span> <span class="sr">//</span> <span class="s">&#39;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span> <span class="nv">$type</span> <span class="ow">eq</span> <span class="s">&#39;ARRAY&#39;</span> <span class="ow">and</span> <span class="n">refaddr</span><span class="p">(</span><span class="nv">$source</span><span class="p">)</span> <span class="o">==</span> <span class="n">refaddr</span><span class="p">(</span><span class="nv">$color</span><span class="p">)</span> <span class="p">)</span> <span class="p">?</span> <span class="mi">1</span> <span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">sub</span> <span class="nf">is_red</span>   <span class="p">{</span> <span class="nv">$is_color</span><span class="o">-&gt;</span><span class="p">(</span><span class="nv">$_</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nv">$red</span><span class="p">)</span>   <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">sub</span> <span class="nf">is_green</span> <span class="p">{</span> <span class="nv">$is_color</span><span class="o">-&gt;</span><span class="p">(</span><span class="nv">$_</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nv">$green</span><span class="p">)</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">sub</span> <span class="nf">is_blue</span>  <span class="p">{</span> <span class="nv">$is_color</span><span class="o">-&gt;</span><span class="p">(</span><span class="nv">$_</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nv">$blue</span><span class="p">)</span>  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>While the code above works, i am unhappy with it. Not because it doesn&rsquo;t work or
has some flaws in it. Mainly because it is not really reusable. Let me explain.</p>
<p>Consider you want to create additional special values. How would you solve it?
At the moment you would just Copy &amp; Paste code, again and again &hellip;</p>
<p>I think Copy &amp; Paste is bad, a lot of people will probably agree. I could fix
that problem by just saying: This is the <strong>Special Values Design-Pattern</strong>. And suddenly
it would become <em>Good Practice</em> for a lot of people. Because obviously <em>Design
Patterns</em> are awesome and good practice, right?</p>
<p>I somehow find it interesting that giving just another name to <em>Copy &amp; Paste</em>
and naming it <em>Design Pattern</em> suddenly makes shit a lot better for many
programmers, but that is just the way how things are. I would claim that every
<em>Design Pattern</em> (or just Copy &amp; Paste) is a flaw that a language is not powerful
enough. This begs the question: Can we make the above code somehow reusable? Can
we create a function that creates the <em>Special Values</em> including
the functions all by itself?</p>
<p>What I have in mind is the following: I only want to write something like</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-perl" data-lang="perl"><span class="line"><span class="cl"><span class="n">enum</span><span class="p">(</span><span class="s">&#39;red&#39;</span><span class="p">,</span> <span class="s">&#39;green&#39;</span><span class="p">,</span> <span class="s">&#39;blue&#39;</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>and the <code>enum</code> function should create the functions <code>red</code>, <code>green</code>, <code>blue</code> including
<code>is_red</code>, <code>is_green</code> and <code>is_blue</code> all by itself. Here I will show you, how to do
this in Perl. This kind of programming is named <a href="https://en.wikipedia.org/wiki/Metaprogramming">Metaprogramming</a>.</p>
<h1 id="typeglobs--symbol-table">Typeglobs &amp; Symbol Table</h1>
<p>To understand Metaprogramming in Perl, we first need to understand the <a href="https://perldoc.perl.org/perlref#Typeglob-Slots">typeglob</a> and the <a href="https://perldoc.perl.org/perlmod#Symbol-Tables">Symbol Table</a>
in Perl.</p>
<p>As you probably know, Perl has different types. Here I don&rsquo;t mean <code>int</code>, <code>float</code>
and so on, more the ability that Perl distinguish between a Scalar, Array, Hash,
Filehandle (IO) and a Subroutine (Code).</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-perl" data-lang="perl"><span class="line"><span class="cl"><span class="k">our</span> <span class="nv">$foo</span> <span class="o">=</span> <span class="s">&#34;foo&#34;</span><span class="p">;</span>          <span class="c1"># Scalar</span>
</span></span><span class="line"><span class="cl"><span class="k">our</span> <span class="nv">@foo</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#34;foo&#34;</span><span class="p">);</span>        <span class="c1"># Array</span>
</span></span><span class="line"><span class="cl"><span class="k">our</span> <span class="nv">%foo</span> <span class="o">=</span> <span class="p">(</span><span class="n">foo</span> <span class="o">=&gt;</span> <span class="s">&#34;Bar&#34;</span><span class="p">);</span> <span class="c1"># Hash</span>
</span></span><span class="line"><span class="cl"><span class="nb">open</span> <span class="n">foo</span><span class="p">,</span> <span class="s">&#39;&lt;&#39;</span><span class="p">,</span> <span class="s">&#39;file&#39;</span><span class="p">;</span>     <span class="c1"># IO</span>
</span></span><span class="line"><span class="cl"><span class="k">sub</span> <span class="nf">foo</span> <span class="p">{</span> <span class="k">return</span> <span class="s">&#34;foo&#34;</span> <span class="p">}</span>   <span class="c1"># Code</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>All of those are named <code>foo</code>, and still they are completely different from each
other. You can safely use <code>$foo</code> along <code>@foo</code> or a function <code>foo()</code> without a
problem in Perl. Something that will not work in JavaScript for example and
many other languages.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">foo</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// This will redefine &#34;foo&#34; to a function
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">function</span> <span class="nx">foo</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="s2">&#34;Hello&#34;</span> <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Next is the Symbol Table. So what is the Symbol Table? As a user of a programming
language you maybe never asked this question, as it maybe seems dumb. But when
you type <code>$foo</code> or <code>@foo</code> or execute a function <code>foo()</code> where are those
variables, functions and so on saved? In the Symbol Table!</p>
<p>The Symbol Table contains all variables, functions and so on. So whenever you
type a variable name, it is looked up in the Symbol Table. In Perl the
Symbol Table itself contains <em>Typeglobs</em>. So what are Typeglobs?</p>
<p>A Typeglob contains all our special values we have in Perl (Scalar, Array, Hash, &hellip;)
and can be used like a Hash in Perl. As an example. All of the above <code>foo</code> values
we created are found in the typeglob named <code>*foo</code>. And we can get <em>references</em>
to those values this way.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-perl" data-lang="perl"><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">$scalar_ref</span> <span class="o">=</span> <span class="o">*</span><span class="n">foo</span><span class="p">{</span><span class="n">SCALAR</span><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">$array_ref</span>  <span class="o">=</span> <span class="o">*</span><span class="n">foo</span><span class="p">{</span><span class="n">ARRAY</span><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">$hash_ref</span>   <span class="o">=</span> <span class="o">*</span><span class="n">foo</span><span class="p">{</span><span class="n">HASH</span><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">$io_ref</span>     <span class="o">=</span> <span class="o">*</span><span class="n">foo</span><span class="p">{</span><span class="n">IO</span><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">$code_ref</span>   <span class="o">=</span> <span class="o">*</span><span class="n">foo</span><span class="p">{</span><span class="n">CODE</span><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>This is the reason why Perl can distinguish <code>$foo</code> from <code>@foo</code>. <code>$foo</code> is saved
in <code>*foo{SCALAR}</code> while <code>@foo</code> is saved in <code>*foo{ARRAY}</code> and so on.</p>
<h1 id="manipulating-the-symbol-table">Manipulating the Symbol Table</h1>
<p>Here comes the interesting part. The Symbol Table itself can be manipulated in Perl
at runtime.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-perl" data-lang="perl"><span class="line"><span class="cl"><span class="k">no</span> <span class="nn">strict</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">*</span><span class="n">foo</span> <span class="o">=</span> <span class="o">\</span><span class="s">&#34;bar&#34;</span><span class="p">;</span>                 <span class="c1"># Assigns to *foo{SCALAR}</span>
</span></span><span class="line"><span class="cl"><span class="o">*</span><span class="n">foo</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#34;foo&#34;</span><span class="p">,</span> <span class="s">&#34;bar&#34;</span><span class="p">];</span>         <span class="c1"># Assigns to *foo{ARRAY}</span>
</span></span><span class="line"><span class="cl"><span class="o">*</span><span class="n">foo</span> <span class="o">=</span> <span class="p">{</span> <span class="n">foo</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="n">bar</span> <span class="o">=&gt;</span> <span class="mi">2</span> <span class="p">};</span> <span class="c1"># Assigns to *foo{HASH}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">say</span> <span class="nv">$foo</span><span class="p">;</span> <span class="c1"># prints &#34;bar&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">say</span> <span class="nv">@foo</span><span class="p">;</span> <span class="c1"># prints &#34;foobar&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">say</span> <span class="nv">%foo</span><span class="p">;</span> <span class="c1"># prints either &#34;foo1bar2&#34; or &#34;bar2foo1&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>First of, when we assign to <code>*foo</code> we just assign it a reference. Depending
on the type of the reference, it will save it in the correct slot. But
we also can access values through the typeglob if wanted/needed.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-perl" data-lang="perl"><span class="line"><span class="cl"><span class="n">say</span> <span class="nv">$</span><span class="p">{</span> <span class="o">*</span><span class="n">foo</span><span class="p">{</span><span class="n">SCALAR</span><span class="p">}</span> <span class="p">};</span> <span class="c1"># prints &#34;bar&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">say</span> <span class="nv">@</span><span class="p">{</span> <span class="o">*</span><span class="n">foo</span><span class="p">{</span><span class="n">ARRAY</span><span class="p">}</span>  <span class="p">};</span> <span class="c1"># prints &#34;foobar&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">say</span> <span class="nv">%</span><span class="p">{</span> <span class="o">*</span><span class="n">foo</span><span class="p">{</span><span class="n">HASH</span><span class="p">}</span>   <span class="p">};</span> <span class="c1"># prints either &#34;foo1bar2&#34; or &#34;bar2foo1&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Consider that accessing the typeglob like <code>*foo{ARRAY}</code> returns a <em>reference</em>.
So we need to <em>de-reference</em> it to access the values. Hence the <code>@{ ... }</code> or
<code>${ ... }</code> around the typeglobs.</p>
<p>Writing <code>*foo</code> is hard-coded, but Perl also allows to use a <em>string</em> to access
the <em>typeglob</em>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-perl" data-lang="perl"><span class="line"><span class="cl"><span class="k">no</span> <span class="nn">strict</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">$name</span> <span class="o">=</span> <span class="s">&#34;foo&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">*</span><span class="nv">$name</span> <span class="o">=</span> <span class="o">\</span><span class="s">&#34;bar&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">*</span><span class="nv">$name</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#34;foo&#34;</span><span class="p">,</span> <span class="s">&#34;bar&#34;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="o">*</span><span class="nv">$name</span> <span class="o">=</span> <span class="p">{</span> <span class="n">foo</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="n">bar</span> <span class="o">=&gt;</span> <span class="mi">2</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">say</span> <span class="nv">$foo</span><span class="p">;</span> <span class="c1"># prints &#34;bar&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">say</span> <span class="nv">@foo</span><span class="p">;</span> <span class="c1"># prints &#34;foobar&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">say</span> <span class="nv">%foo</span><span class="p">;</span> <span class="c1"># prints either &#34;foo1bar2&#34; or &#34;bar2foo1&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Writing <code>*$name</code> is a shortcut syntax for writing. <code>*{ $name }</code>. We can consider
the <code>*</code> as accessing the type glob and pass the name we want to access as
a variable name.</p>
<p>First note the <a href="https://metacpan.org/pod/strict">no strict;</a>. In Perl it usually is a good idea to <code>use strict;</code>.
Also requiring a new Perl version like <code>use v5.36</code> enables <code>use strict;</code> or loading
some module like <a href="https://metacpan.org/pod/Moose">Moose</a> does so.</p>
<p>In 99% this is good because it deactivates certain Perl syntax to disable
manipulating the symbol table. But in this case that is exactly what we want. With
<code>no strict;</code> we can re-enable those features (or disable the disabling of features).</p>
<p>With all of this knowledge, now let&rsquo;s write our <code>enum</code></p>
<h1 id="implementing-enum">Implementing enum</h1>
<p>First of I would create a single function only creating one special value
at a time.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-perl" data-lang="perl"><span class="line"><span class="cl"><span class="k">use</span> <span class="nn">v5</span><span class="mf">.36</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nn">Scalar::Util</span> <span class="sx">qw(refaddr reftype)</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nn">Term::ANSIColor</span> <span class="sx">qw(color)</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">sub</span> <span class="nf">create_special</span><span class="p">($name) {</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># disable strict refs inside this function</span>
</span></span><span class="line"><span class="cl">    <span class="k">no</span> <span class="nn">strict</span> <span class="s">&#39;refs&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># our special value</span>
</span></span><span class="line"><span class="cl">    <span class="k">my</span> <span class="nv">$special</span> <span class="o">=</span> <span class="o">[]</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># create $name function that returns our special value</span>
</span></span><span class="line"><span class="cl">    <span class="o">*</span><span class="p">{</span> <span class="nv">$name</span> <span class="p">}</span> <span class="o">=</span> <span class="k">sub</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nv">$special</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># create &#34;is_&#34;$name function, checking if passed value is</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># identical to $special</span>
</span></span><span class="line"><span class="cl">    <span class="o">*</span><span class="p">{</span> <span class="s">&#34;is_&#34;</span> <span class="o">.</span> <span class="nv">$name</span> <span class="p">}</span> <span class="o">=</span> <span class="k">sub</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">my</span> <span class="p">(</span><span class="nv">$value</span><span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">my</span> <span class="nv">$type</span> <span class="o">=</span> <span class="n">reftype</span><span class="p">(</span><span class="nv">$value</span><span class="p">)</span> <span class="sr">//</span> <span class="s">&#34;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># check if arrayref was passed</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span> <span class="nv">$type</span> <span class="ow">eq</span> <span class="s">&#39;ARRAY&#39;</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># check if addresses are the same</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span> <span class="n">refaddr</span><span class="p">(</span><span class="nv">$value</span><span class="p">)</span> <span class="o">==</span> <span class="n">refaddr</span><span class="p">(</span><span class="nv">$special</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>This would now allow writing <code>create_special(&quot;foo&quot;)</code> that creates a <code>foo()</code> and
<code>Ã¬s_foo()</code> function returning and checking our special value. Now <code>enum</code> can
just be implemented by calling this function in a loop.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-perl" data-lang="perl"><span class="line"><span class="cl"><span class="k">sub</span> <span class="nf">enum</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="k">my</span> <span class="nv">$name</span> <span class="p">(</span> <span class="nv">@_</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">create_special</span><span class="p">(</span><span class="nv">$name</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>finally, we can write:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-perl" data-lang="perl"><span class="line"><span class="cl"><span class="n">enum</span><span class="p">(</span><span class="s">&#39;red&#39;</span><span class="p">,</span> <span class="s">&#39;green&#39;</span><span class="p">,</span> <span class="s">&#39;blue&#39;</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The implementation of <code>print_colored</code> stays the same.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-perl" data-lang="perl"><span class="line"><span class="cl"><span class="k">sub</span> <span class="nf">print_colored</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="k">my</span> <span class="nv">$line</span> <span class="p">(</span> <span class="nv">@_</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">print</span><span class="p">(</span><span class="n">color</span><span class="p">(</span><span class="s">&#39;red&#39;</span><span class="p">))</span>   <span class="o">&amp;&amp;</span> <span class="k">next</span> <span class="k">if</span> <span class="n">is_red</span><span class="p">(</span><span class="nv">$line</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">print</span><span class="p">(</span><span class="n">color</span><span class="p">(</span><span class="s">&#39;green&#39;</span><span class="p">))</span> <span class="o">&amp;&amp;</span> <span class="k">next</span> <span class="k">if</span> <span class="n">is_green</span><span class="p">(</span><span class="nv">$line</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">print</span><span class="p">(</span><span class="n">color</span><span class="p">(</span><span class="s">&#39;blue&#39;</span><span class="p">))</span>  <span class="o">&amp;&amp;</span> <span class="k">next</span> <span class="k">if</span> <span class="n">is_blue</span><span class="p">(</span><span class="nv">$line</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">print</span> <span class="nv">$line</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>But there can be one problem. When we now just try to write.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-perl" data-lang="perl"><span class="line"><span class="cl"><span class="n">print_colored</span><span class="p">(</span><span class="n">green</span><span class="p">,</span> <span class="s">&#34;RED&#34;</span><span class="p">,</span> <span class="s">&#34;\n&#34;</span><span class="p">,</span> <span class="n">blue</span><span class="p">,</span> <span class="s">&#34;GREEN&#34;</span><span class="p">,</span> <span class="s">&#34;\n&#34;</span><span class="p">,</span> <span class="n">red</span><span class="p">,</span> <span class="s">&#34;BLUE&#34;</span><span class="p">,</span> <span class="s">&#34;\n&#34;</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>we get the following compile-time error.</p>
<pre tabindex="0"><code>Bareword &#34;green&#34; not allowed while &#34;strict subs&#34; in use at ./metaprogramming.pl line xxx.
Bareword &#34;blue&#34; not allowed while &#34;strict subs&#34; in use at ./metaprogramming.pl line xxx.
Bareword &#34;red&#34; not allowed while &#34;strict subs&#34; in use at ./metaprogramming.pl line xxx.
Execution of ./metaprogramming.pl aborted due to compilation errors.
</code></pre><p>The reason for this is the following:</p>
<ol>
<li>Perl has a compile-time and a runtime-stage.</li>
<li>The function <code>red</code>, <code>green</code>, &hellip; are created at the runtime-stage.</li>
<li>When the compiler hits the <code>print_colored</code> line at the compile-time,
the compiler don&rsquo;t know about the functions <code>red</code>, <code>green</code> and <code>blue</code>. Only
functions that the compiler knows so far at the compile-time are allowed
to be called without parenthesis. (This usually fetches a lot of errors).</li>
</ol>
<p>There are two ways to fix this problem.</p>
<h2 id="first">First</h2>
<p>We could add parenthesis. This way the compiler knows that we want to
call a function and those errors about the <em>bareword</em> goes away. That&rsquo;s also
the reason why we never got an error writing the <code>print_colored</code> function even
the fact we used the <code>is_red()</code>, &hellip; functions there.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-perl" data-lang="perl"><span class="line"><span class="cl"><span class="n">print_colored</span><span class="p">(</span><span class="n">green</span><span class="p">(),</span> <span class="s">&#34;RED&#34;</span><span class="p">,</span> <span class="s">&#34;\n&#34;</span><span class="p">,</span> <span class="n">blue</span><span class="p">(),</span> <span class="s">&#34;GREEN&#34;</span><span class="p">,</span> <span class="s">&#34;\n&#34;</span><span class="p">,</span> <span class="n">red</span><span class="p">(),</span> <span class="s">&#34;BLUE&#34;</span><span class="p">,</span> <span class="s">&#34;\n&#34;</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="second">Second</h2>
<p>We can add <code>BEGIN { }</code> around our <code>enum</code> call.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-perl" data-lang="perl"><span class="line"><span class="cl"><span class="k">BEGIN</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">enum</span><span class="p">(</span><span class="s">&#39;red&#39;</span><span class="p">,</span> <span class="s">&#39;green&#39;</span><span class="p">,</span> <span class="s">&#39;blue&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><a href="https://perldoc.perl.org/perlmod#BEGIN%2C-UNITCHECK%2C-CHECK%2C-INIT-and-END">BEGIN</a> is a special block in Perl that tells the compiler to immediately run
the code before continuing compiling the rest of the program. This way the function
gets created at compile-time. When the compiler sees the line.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-perl" data-lang="perl"><span class="line"><span class="cl"><span class="n">print_colored</span><span class="p">(</span><span class="n">green</span><span class="p">,</span> <span class="s">&#34;RED&#34;</span><span class="p">,</span> <span class="s">&#34;\n&#34;</span><span class="p">,</span> <span class="n">blue</span><span class="p">,</span> <span class="s">&#34;GREEN&#34;</span><span class="p">,</span> <span class="s">&#34;\n&#34;</span><span class="p">,</span> <span class="n">red</span><span class="p">,</span> <span class="s">&#34;BLUE&#34;</span><span class="p">,</span> <span class="s">&#34;\n&#34;</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>it knows about the <code>green</code>, <code>red</code>, &hellip; functions and don&rsquo;t complain about
<em>barewords</em> anymore.</p>

        </div>
        <div class="post-footer">
            <div id="disqus_thread"></div>
<script type="application/javascript">
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "davidraab" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        </div>
    </article>
</main>
<aside> <nav id="TableOfContents">
  <ul>
    <li><a href="#typeglobs--symbol-table">Typeglobs &amp; Symbol Table</a></li>
    <li><a href="#manipulating-the-symbol-table">Manipulating the Symbol Table</a></li>
    <li><a href="#implementing-enum">Implementing enum</a>
      <ul>
        <li><a href="#first">First</a></li>
        <li><a href="#second">Second</a></li>
      </ul>
    </li>
  </ul>
</nav> </aside>

    </body>
</html>
