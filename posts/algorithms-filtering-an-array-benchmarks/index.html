<!doctype html>
<html lang="en-us">
    <head>
        <title>Algorithms: Filtering an Array (Benchmarks) // David Raab</title>
        <link rel="shortcut icon" href="/favicon.ico" />
        <meta charset="utf-8" />
        <meta name="generator" content="Hugo 0.123.1">
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta name="author" content="David Raab" />
        <meta name="description" content="" />
        <link rel="stylesheet" href="/css/main.min.0fa334c3f2650e7000dfc8e81f59d23191e59e78f62c565a598f4dc557c92abe.css" />
        <script src="/static/code-toggle.js"></script>

        
        <meta name="twitter:card" content="summary"/><meta name="twitter:title" content="Algorithms: Filtering an Array (Benchmarks)"/>
<meta name="twitter:description" content="1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 #!"/>

        <meta property="og:title" content="Algorithms: Filtering an Array (Benchmarks)" />
<meta property="og:description" content="1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 #!" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://davidraab.github.io/posts/algorithms-filtering-an-array-benchmarks/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-10-12T00:00:00+00:00" />
<meta property="article:modified_time" content="2024-10-12T00:00:00+00:00" />



    </head>
    <body>
        <header class="app-header">
            <a href="https://davidraab.github.io/"><img class="app-header-avatar" src="/avatar.jpg" alt="David Raab" /></a>
            <span class="app-header-title">David Raab</span>
            <nav class="app-header-menu">
                    <a class="app-header-menu-item" href="/">Home</a>
                         - 
                    
                    <a class="app-header-menu-item" href="/tags/">Tags</a>
            </nav>
            <p>Writing about programming (Perl, F#) and other stuff.</p>
            <div class="app-header-social">
                
                    <a href="https://github.com/DavidRaab" target="_blank" rel="noreferrer noopener me">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github">
  <title>David Raab Github Profile</title>
  <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
</svg>
                    </a>
                
                    <a href="https://davidraab.github.io/index.xml" target="_blank" rel="noreferrer noopener me">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-rss">
  <title>Atom Feed</title>
  <path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle>
</svg>
                    </a>
                
            </div>
        </header>
        
<main class="app-container">
    <article class="post">
        <header class="post-header">
            <h1 class ="post-title">Algorithms: Filtering an Array (Benchmarks)</h1>
            <div class="post-meta">
                <div>
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar">
  <title>calendar</title>
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line>
</svg>
                    Oct 12, 2024
                </div>
                <div>
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock">
  <title>clock</title>
  <circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline>
</svg>
                    6 min read
                </div>
                <div>
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag">
  <title>tag</title>
  <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line>
</svg>
                            <a class="tag" href="https://davidraab.github.io/tags/algorithms/">Algorithms</a>
                            <a class="tag" href="https://davidraab.github.io/tags/data-structures/">Data-Structures</a>
                            <a class="tag" href="https://davidraab.github.io/tags/array/">Array</a>
                </div>
            </div>
        </header>
        <div class="post-content">
            <div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-perl" data-lang="perl"><span class="line"><span class="cl"><span class="ch">#!/usr/bin/env perl</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nn">v5</span><span class="mf">.36</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nn">open</span> <span class="s">&#39;:std&#39;</span><span class="p">,</span> <span class="s">&#39;:encoding(UTF-8)&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nn">Sq</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nn">Benchmark</span> <span class="sx">qw(cmpthese)</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># It started by bechmarking and looking at different filtering implementation</span>
</span></span><span class="line"><span class="cl"><span class="c1"># especially looking at the performance of a full mutable version that</span>
</span></span><span class="line"><span class="cl"><span class="c1"># mutates an array and removes entries instead of createing a new on. This</span>
</span></span><span class="line"><span class="cl"><span class="c1"># version is `by_splice`. Because it mutates and correct benchmarking behaviour</span>
</span></span><span class="line"><span class="cl"><span class="c1"># must be ensured there are versions that copies the array first to really</span>
</span></span><span class="line"><span class="cl"><span class="c1"># compare the difference of the algorithms. But there are also version without</span>
</span></span><span class="line"><span class="cl"><span class="c1"># copies that shows a more practical version.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># creates array with 10_000 random integer numbers</span>
</span></span><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">$amount</span>  <span class="o">=</span> <span class="mi">10_000</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">$numbers</span> <span class="o">=</span> <span class="nn">Array</span><span class="o">-&gt;</span><span class="n">init</span><span class="p">(</span><span class="nv">$amount</span><span class="p">,</span> <span class="n">sub</span><span class="p">(</span><span class="nv">$idx</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nb">int</span> <span class="p">(</span><span class="nb">rand</span><span class="p">(</span><span class="mi">100_000</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># evens with perl built-in grep</span>
</span></span><span class="line"><span class="cl"><span class="k">sub</span> <span class="nf">by_grep</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">my</span> <span class="nv">$numbers</span> <span class="o">=</span> <span class="nv">$numbers</span><span class="o">-&gt;</span><span class="n">copy</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">my</span> <span class="nv">@evens</span>   <span class="o">=</span> <span class="nb">grep</span> <span class="p">{</span> <span class="nv">$_</span> <span class="nv">%</span> <span class="nv">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">}</span> <span class="nv">@$numbers</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># filtering but c-style</span>
</span></span><span class="line"><span class="cl"><span class="k">sub</span> <span class="nf">by_manual</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">my</span> <span class="nv">$numbers</span> <span class="o">=</span> <span class="nv">$numbers</span><span class="o">-&gt;</span><span class="n">copy</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">my</span> <span class="nv">@evens</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="k">my</span> <span class="nv">$num</span> <span class="p">(</span> <span class="nv">@$numbers</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span> <span class="nv">$num</span> <span class="nv">%</span> <span class="nv">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nb">push</span> <span class="nv">@evens</span><span class="p">,</span> <span class="nv">$num</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># full mutable version that changes array</span>
</span></span><span class="line"><span class="cl"><span class="k">sub</span> <span class="nf">by_splice</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">my</span> <span class="nv">$numbers</span> <span class="o">=</span> <span class="nv">$numbers</span><span class="o">-&gt;</span><span class="n">copy</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">my</span> <span class="nv">$idx</span>     <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">while</span> <span class="p">(</span> <span class="nv">$idx</span> <span class="o">&lt;</span> <span class="nv">@$numbers</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span> <span class="nv">$numbers</span><span class="o">-&gt;</span><span class="p">[</span><span class="nv">$idx</span><span class="p">]</span> <span class="nv">%</span> <span class="nv">2</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nb">splice</span> <span class="nv">@$numbers</span><span class="p">,</span> <span class="nv">$idx</span><span class="p">,</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">next</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$idx</span><span class="o">++</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># using lazy sequence</span>
</span></span><span class="line"><span class="cl"><span class="k">sub</span> <span class="nf">by_seq</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">my</span> <span class="nv">$numbers</span> <span class="o">=</span> <span class="nv">$numbers</span><span class="o">-&gt;</span><span class="n">copy</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">my</span> <span class="nv">$evens</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">        <span class="nn">Seq</span>
</span></span><span class="line"><span class="cl">        <span class="o">-&gt;</span><span class="n">from_array</span><span class="p">(</span><span class="nv">$numbers</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">-&gt;</span><span class="n">filter</span><span class="p">(</span><span class="n">sub</span><span class="p">(</span><span class="nv">$x</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$x</span> <span class="nv">%</span> <span class="nv">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">})</span>
</span></span><span class="line"><span class="cl">        <span class="o">-&gt;</span><span class="n">to_array</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">###- no copy versions</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># like grep but without copies (nc = no copy)</span>
</span></span><span class="line"><span class="cl"><span class="k">sub</span> <span class="nf">by_grep_nc</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">my</span> <span class="nv">@evens</span> <span class="o">=</span> <span class="nb">grep</span> <span class="p">{</span> <span class="nv">$_</span> <span class="nv">%</span> <span class="nv">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">}</span> <span class="nv">@$numbers</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">sub</span> <span class="nf">by_seq_nc</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">my</span> <span class="nv">$evens</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">        <span class="nn">Seq</span>
</span></span><span class="line"><span class="cl">        <span class="o">-&gt;</span><span class="n">from_array</span><span class="p">(</span><span class="nv">$numbers</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">-&gt;</span><span class="n">filter</span><span class="p">(</span><span class="n">sub</span><span class="p">(</span><span class="nv">$x</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$x</span> <span class="nv">%</span> <span class="nv">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">})</span>
</span></span><span class="line"><span class="cl">        <span class="o">-&gt;</span><span class="n">to_array</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># this is like the grep version, but uses Sq</span>
</span></span><span class="line"><span class="cl"><span class="k">sub</span> <span class="nf">array_filter</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">my</span> <span class="nv">$evens</span> <span class="o">=</span> <span class="nv">$numbers</span><span class="o">-&gt;</span><span class="n">filter</span><span class="p">(</span><span class="n">sub</span><span class="p">(</span><span class="nv">$x</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$x</span> <span class="nv">%</span> <span class="nv">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># same as filter but uses string-eval to build up query instead of lambda</span>
</span></span><span class="line"><span class="cl"><span class="k">sub</span> <span class="nf">array_filter_e</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">my</span> <span class="nv">$evens</span> <span class="o">=</span> <span class="nv">$numbers</span><span class="o">-&gt;</span><span class="n">filter_e</span><span class="p">(</span><span class="s">&#39;$_ % 2 == 0&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># this creates an &#34;immutable linked list&#34; from array</span>
</span></span><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">$list</span> <span class="o">=</span> <span class="nn">List</span><span class="o">-&gt;</span><span class="n">from_array</span><span class="p">(</span><span class="nv">$numbers</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">sub</span> <span class="nf">list_filter</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">my</span> <span class="nv">$evens</span> <span class="o">=</span> <span class="nv">$list</span><span class="o">-&gt;</span><span class="n">filter</span><span class="p">(</span><span class="n">sub</span><span class="p">(</span><span class="nv">$x</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$x</span> <span class="nv">%</span> <span class="nv">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># same, but with functional-style call</span>
</span></span><span class="line"><span class="cl"><span class="k">sub</span> <span class="nf">list_filter_nm</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">my</span> <span class="nv">$evens</span> <span class="o">=</span> <span class="nn">List::</span><span class="n">filter</span><span class="p">(</span><span class="nv">$list</span><span class="p">,</span> <span class="n">sub</span><span class="p">(</span><span class="nv">$x</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$x</span> <span class="nv">%</span> <span class="nv">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">###- first_5_* versions</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># only getting first 5 even numbers</span>
</span></span><span class="line"><span class="cl"><span class="k">sub</span> <span class="nf">first_5_manual</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">my</span> <span class="nv">$numbers</span> <span class="o">=</span> <span class="nv">$numbers</span><span class="o">-&gt;</span><span class="n">copy</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">my</span> <span class="nv">$count</span>   <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">my</span> <span class="nv">@evens</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="k">my</span> <span class="nv">$x</span> <span class="p">(</span> <span class="nv">@$numbers</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span> <span class="nv">$x</span> <span class="nv">%</span> <span class="nv">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nb">push</span> <span class="nv">@evens</span><span class="p">,</span> <span class="nv">$x</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">last</span> <span class="k">if</span> <span class="o">++</span><span class="nv">$count</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">sub</span> <span class="nf">first_5_manual_nc</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">my</span> <span class="nv">$count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">my</span> <span class="nv">@evens</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="k">my</span> <span class="nv">$x</span> <span class="p">(</span> <span class="nv">@$numbers</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span> <span class="nv">$x</span> <span class="nv">%</span> <span class="nv">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nb">push</span> <span class="nv">@evens</span><span class="p">,</span> <span class="nv">$x</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">last</span> <span class="k">if</span> <span class="o">++</span><span class="nv">$count</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># getting first 5 even numbers, but code is still abstract like using grep</span>
</span></span><span class="line"><span class="cl"><span class="k">sub</span> <span class="nf">first_5_seq</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">my</span> <span class="nv">$numbers</span> <span class="o">=</span> <span class="nv">$numbers</span><span class="o">-&gt;</span><span class="n">copy</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">my</span> <span class="nv">$evens</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">        <span class="nn">Seq</span>
</span></span><span class="line"><span class="cl">        <span class="o">-&gt;</span><span class="n">from_array</span><span class="p">(</span><span class="nv">$numbers</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">-&gt;</span><span class="n">filter</span><span class="p">(</span><span class="n">sub</span><span class="p">(</span><span class="nv">$x</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$x</span> <span class="nv">%</span> <span class="nv">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">})</span>
</span></span><span class="line"><span class="cl">        <span class="o">-&gt;</span><span class="n">take</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">-&gt;</span><span class="n">to_array</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># when @numbers changes, then $evens will evaluate to the latest updates</span>
</span></span><span class="line"><span class="cl"><span class="c1"># on trying to fetch data from it.</span>
</span></span><span class="line"><span class="cl"><span class="k">sub</span> <span class="nf">first_5_seq_nc</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">my</span> <span class="nv">$evens</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">        <span class="nn">Seq</span>
</span></span><span class="line"><span class="cl">        <span class="o">-&gt;</span><span class="n">from_array</span><span class="p">(</span><span class="nv">$numbers</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">-&gt;</span><span class="n">filter</span><span class="p">(</span><span class="n">sub</span><span class="p">(</span><span class="nv">$x</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$x</span> <span class="nv">%</span> <span class="nv">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">})</span>
</span></span><span class="line"><span class="cl">        <span class="o">-&gt;</span><span class="n">take</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">-&gt;</span><span class="n">to_array</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">sub</span> <span class="nf">first_5_list</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">my</span> <span class="nv">$evens</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$list</span>
</span></span><span class="line"><span class="cl">        <span class="o">-&gt;</span><span class="n">filter</span><span class="p">(</span><span class="n">sub</span><span class="p">(</span><span class="nv">$x</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$x</span> <span class="nv">%</span> <span class="nv">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">        <span class="o">-&gt;</span><span class="n">take</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">sub</span> <span class="nf">first_5_array</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">my</span> <span class="nv">$evens</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">        <span class="nn">Array::</span><span class="n">filter</span><span class="p">(</span><span class="nv">$numbers</span><span class="p">,</span> <span class="n">sub</span><span class="p">(</span><span class="nv">$x</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$x</span> <span class="nv">%</span> <span class="nv">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">        <span class="o">-&gt;</span><span class="n">take</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># doing grep and then just picking first 5</span>
</span></span><span class="line"><span class="cl"><span class="k">sub</span> <span class="nf">first_5_grep</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">my</span> <span class="nv">@evens</span>   <span class="o">=</span> <span class="nb">grep</span> <span class="p">{</span> <span class="nv">$_</span> <span class="nv">%</span> <span class="nv">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">}</span> <span class="nv">@$numbers</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">my</span> <span class="nv">@first_5</span> <span class="o">=</span> <span class="nv">@evens</span><span class="p">[</span><span class="mi">0</span><span class="o">..</span><span class="mi">4</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">printf</span> <span class="s">&#34;Benchmarking versions with array copies.\n&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">cmpthese</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#39;seq&#39;</span>            <span class="o">=&gt;</span> <span class="o">\&amp;</span><span class="n">by_seq</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#39;splice&#39;</span>         <span class="o">=&gt;</span> <span class="o">\&amp;</span><span class="n">by_splice</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#39;manual&#39;</span>         <span class="o">=&gt;</span> <span class="o">\&amp;</span><span class="n">by_manual</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#39;grep&#39;</span>           <span class="o">=&gt;</span> <span class="o">\&amp;</span><span class="n">by_grep</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#39;first_5_seq&#39;</span>    <span class="o">=&gt;</span> <span class="o">\&amp;</span><span class="n">first_5_seq</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#39;first_5_manual&#39;</span> <span class="o">=&gt;</span> <span class="o">\&amp;</span><span class="n">first_5_manual</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">printf</span> <span class="s">&#34;\nFiltering all with different data-structures. No Array copies.\n&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">cmpthese</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#39;list&#39;</span>    <span class="o">=&gt;</span> <span class="o">\&amp;</span><span class="n">list_filter</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#39;list_nm&#39;</span> <span class="o">=&gt;</span> <span class="o">\&amp;</span><span class="n">list_filter_nm</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#39;seq&#39;</span>     <span class="o">=&gt;</span> <span class="o">\&amp;</span><span class="n">by_seq_nc</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#39;array&#39;</span>   <span class="o">=&gt;</span> <span class="o">\&amp;</span><span class="n">array_filter</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#39;array_e&#39;</span> <span class="o">=&gt;</span> <span class="o">\&amp;</span><span class="n">array_filter_e</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#39;grep&#39;</span>    <span class="o">=&gt;</span> <span class="o">\&amp;</span><span class="n">by_grep_nc</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">printf</span> <span class="s">&#34;\nGetting only first 5 even numbers.\n&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">cmpthese</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#39;first_5_list&#39;</span>      <span class="o">=&gt;</span> <span class="o">\&amp;</span><span class="n">first_5_list</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#39;first_5_array&#39;</span>     <span class="o">=&gt;</span> <span class="o">\&amp;</span><span class="n">first_5_array</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#39;first_5_grep&#39;</span>      <span class="o">=&gt;</span> <span class="o">\&amp;</span><span class="n">first_5_grep</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#39;first_5_seq&#39;</span>       <span class="o">=&gt;</span> <span class="o">\&amp;</span><span class="n">first_5_seq_nc</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#39;first_5_manual_nc&#39;</span> <span class="o">=&gt;</span> <span class="o">\&amp;</span><span class="n">first_5_manual_nc</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">print</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">$numbers</span><span class="o">-&gt;</span><span class="n">count</span> <span class="o">==</span> <span class="nv">$amount</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">?</span> <span class="s">&#34;\nok - correct \$numbers count\n&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">:</span> <span class="s">&#34;\nnot ok - \$numbers count should be 10000\n&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Benchmark results on my machine</p>
<pre><code>Benchmarking versions with array copies.
                Rate     seq  splice  manual    grep first_5_seq first_5_manual
seq             275/s      --    -25%    -77%    -79%        -89%           -89%
splice          366/s     33%      --    -70%    -72%        -85%           -86%
manual         1208/s    339%    230%      --     -6%        -52%           -53%
grep           1291/s    370%    253%      7%      --        -49%           -50%
first_5_seq    2511/s    814%    587%    108%     94%          --            -3%
first_5_manual 2595/s    845%    610%    115%    101%          3%             --

Filtering all with different data-structures. No Array copies.
        Rate    list list_nm     seq   array array_e    grep
list     197/s      --     -1%    -33%    -72%    -92%    -92%
list_nm  199/s      1%      --    -33%    -72%    -92%    -92%
seq      296/s     50%     49%      --    -58%    -88%    -88%
array    704/s    257%    254%    137%      --    -72%    -72%
array_e 2535/s   1186%   1174%    755%    260%      --     -0%
grep    2535/s   1186%   1174%    755%    260%      0%      --

Getting only first 5 even numbers.
                    Rate first_5_list first_5_array first_5_grep first_5_seq first_5_manual_nc
first_5_list          197/s           --          -72%         -92%       -100%             -100%
first_5_array         697/s         254%            --         -72%        -99%             -100%
first_5_grep         2488/s        1162%          257%           --        -97%             -100%
first_5_seq         87682/s       44370%        12476%        3424%          --              -93%
first_5_manual_nc 1336170/s      677575%       191549%       53605%       1424%                --

ok - correct $numbers count
</code></pre>

        </div>
        <div class="post-footer">
            <div id="disqus_thread"></div>
<script>
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "davidraab" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        </div>
    </article>
</main>
<aside> <nav id="TableOfContents"></nav> </aside>

    </body>
</html>
